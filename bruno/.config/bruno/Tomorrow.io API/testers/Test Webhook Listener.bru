meta {
  name: Test Webhook Listener
  type: http
  seq: 1
}

post {
  url: http://localhost:3000/notifications
  body: json
  auth: inherit
}

body:json {
  {{body}}
}

script:pre-request {
  var isCustomInsight = false;
  
  var payload = isCustomInsight ? {
      "data": {
          "alert":{
              "id": "3805b6c8-dd6f-4dac-9dc2-fb9ea2702a80",
              "insight": "bd9faf50-bf00-4d09-a5e3-413799c05609",
              "name": "Moderate Snow in Pacific Central Station, Vancouver",
              "isActive": true,
              "notifications": [
                  {
                      "type": "PRIOR",
                      "value": 120,
                      "title": "Monitor: Moderate Snow Expected within 2 Hours",
                      "description": "Look out for surge caused by incoming moderate snow (<2mm).",
                  },
                  {
                      "type": "END",
                      "title": "All Clear: Moderate Snow Ended",
                      "description": "Back to normal, snowfall has ended.",
                  }
              ],
              "createdAt": "2021-03-25T16:49:34+0000"
          
      },
          "insight": {
              "id": "bd9faf50-bf00-4d09-a5e3-413799c05609"
          },
          "locations": [
            { "id": "38f689d83c264eb0b084ba39975f3413" }, 
          ],         
          "notification": {
              "type": "PRIOR",
              "value": 30,
              "title": "Low Visibility Advisory",
              "description": "* WHAT... Visibility 1km or less * WHEN... in 30 minutes * IMPACTS... Hazardous driving conditions due to low visibility * ACTIONS... If driving, slow down, use your headlights, and leave plenty of distance ahead of you."
          },
          "event": {
              "startTime": "2020-05-10T07:49:34+0000",
              "eventValues": {
                  "visibility": 0.52
              },
              "triggerValues": {
                  "visibility": 0.52
              }
          }
      }
  } : {
      "data": {
          "alert":             
          {
              "id": "3805b6c8-dd6f-4dac-9dc2-fb9ea2702a73",
              "insight": "floods",
              "name": "Flood Hazards",
              "isActive": true,
              "notifications":  [
                {
                  type: "PUBLISHED",
                  title: "Floow Hazard Report",
                  description:
                    "Our sourced issued a new flood hazard announcement. Stay safe.",
                },
              ],
              "createdAt": "2021-03-25T06:49:34+0000"
          },
          "insight": {
              "id": "floods",
          },
          "location": { "id": "5ea83909b9dc140008627002" }, // DEPRECATED  
          "locations": [
            { "id": "5ea83909b9dc140008627002" }, 
            { "id": "5ea83909b9dc140008627003" }, 
            { "id": "5ea83909b9dc140008627004" },
          ],
          "notification": {
              "type": "PUBLISH",
              "title": "Flood Hazard",
              "description": "A flood hazard has been published. Review hazard details. "
          },
          "event": {
              "startTime": "2020-10-13T18:12:00Z",             
              "endTime": "2020-10-14T15:06:26.261668224Z",     
              "updateTime": "2020-10-13T18:12:00Z",            
              "severity": "unknown",                           
              "certainty": "likely",                         
              "urgency": "unknown",                            
              "source": "https://alerts.weather.gov/cap/...",  
              "eventValues": {
                    "origin": "NWS",                           
                    "title": "Small Craft Advisory",          
                    "description": "* WHAT...Northwest... ",   
                    "instruction": "Inexperienced... ",        
                    "response": "avoid",                       
                    "geocodes": ["PZZ576"],                    
                    "location": {type:"Point", "coordinates": [-86.660156, 35.860119]},              
                  },
              }
          }
  };
  
  var body = payload;
  
  bru.setEnvVar('body', JSON.stringify(body));
}

settings {
  encodeUrl: true
}
